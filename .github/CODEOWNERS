* @streamlit/community-cloud
import streamlit as st
import math
import matplotlib.pyplot as plt
from io import BytesIO
from reportlab.lib.pagesizes import A4
from reportlab.lib.units import cm
from reportlab.pdfgen import canvas

# ======= ESTILO PERSONALIZADO =======
st.markdown("""
    <style>
        .main {
            background-color: #0f0f0f;
            color: #f5f5f5;
        }
        .stButton>button {
            background-color: #d4af37;
            color: black;
            border-radius: 10px;
            height: 3em;
            width: 100%;
            font-weight: bold;
        }
        .stButton>button:hover {
            background-color: #ffd700;
            color: black;
        }
        h1, h2, h3 {
            color: #d4af37;
            text-align: center;
            font-family: 'Helvetica Neue', sans-serif;
        }
    </style>
""", unsafe_allow_html=True)

# ======= T√çTULO =======
st.title("üèãÔ∏è‚Äç‚ôÇÔ∏è Torugo‚Äôs Fit")
st.subheader("üìä Avalia√ß√£o de Composi√ß√£o Corporal - 7 Dobras (Jackson & Pollock)")

st.write("Preencha os campos abaixo para calcular o percentual de gordura corporal:")

# ======= ENTRADAS =======
sexo = st.selectbox("Sexo", ["Masculino", "Feminino"])
idade = st.number_input("Idade (anos)", min_value=10, max_value=100, step=1)
peso = st.number_input("Peso corporal (kg)", min_value=20.0, max_value=200.0, step=0.1)

st.markdown("### üìè Medidas das 7 Dobras Cut√¢neas (mm)")
peitoral = st.number_input("Peitoral", min_value=0.0, step=0.1)
abdominal = st.number_input("Abdominal", min_value=0.0, step=0.1)
coxa = st.number_input("Coxa", min_value=0.0, step=0.1)
triceps = st.number_input("Tr√≠ceps", min_value=0.0, step=0.1)
subescapular = st.number_input("Subescapular", min_value=0.0, step=0.1)
suprailiaca = st.number_input("Supra-il√≠aca", min_value=0.0, step=0.1)
axilar = st.number_input("Axilar M√©dia", min_value=0.0, step=0.1)

# ======= BOT√ÉO DE C√ÅLCULO =======
if st.button("Calcular Composi√ß√£o Corporal"):
    soma_dobras = peitoral + abdominal + coxa + triceps + subescapular + suprailiaca + axilar

    # F√≥rmulas de Jackson & Pollock
    if sexo == "Masculino":
        densidade = 1.112 - (0.00043499 * soma_dobras) + (0.00000055 * soma_dobras ** 2) - (0.00028826 * idade)
    else:
        densidade = 1.097 - (0.00046971 * soma_dobras) + (0.00000056 * soma_dobras ** 2) - (0.00012828 * idade)

    percentual_gordura = ((4.95 / densidade) - 4.50) * 100
    massa_gorda = (percentual_gordura / 100) * peso
    massa_magra = peso - massa_gorda

    # ======= CLASSIFICA√á√ÉO ACSM =======
    def classificacao(sexo, percentual):
        if sexo == "Masculino":
            if percentual < 6: return "Essencial"
            elif percentual < 14: return "Atl√©tico"
            elif percentual < 18: return "Bom"
            elif percentual < 25: return "Normal"
            else: return "Acima do ideal"
        else:
            if percentual < 14: return "Essencial"
            elif percentual < 21: return "Atl√©tica"
            elif percentual < 25: return "Boa"
            elif percentual < 32: return "Normal"
            else: return "Acima do ideal"

    classificacao_final = classificacao(sexo, percentual_gordura)

    # ======= RESULTADOS =======
    st.markdown("## üìâ Resultados")
    st.write(f"**Densidade corporal:** {densidade:.4f} g/cm¬≥")
    st.write(f"**Percentual de gordura:** {percentual_gordura:.2f}%")
    st.write(f"**Massa gorda:** {massa_gorda:.2f} kg")
    st.write(f"**Massa magra:** {massa_magra:.2f} kg")
    st.success(f"**Classifica√ß√£o: {classificacao_final}**")

    # ======= GR√ÅFICO =======
    fig, ax = plt.subplots()
    ax.pie(
        [massa_magra, massa_gorda],
        labels=["Massa Magra", "Massa Gorda"],
        autopct="%.1f%%",
        startangle=90,
    )
    ax.set_title("Distribui√ß√£o Corporal")
    st.pyplot(fig)

    # ======= GERAR PDF =======
    buffer = BytesIO()
    pdf = canvas.Canvas(buffer, pagesize=A4)
    pdf.setTitle("Relat√≥rio Torugo‚Äôs Fit")
    pdf.setFont("Helvetica-Bold", 18)
    pdf.setFillColorRGB(0.83, 0.68, 0.22)
    pdf.drawString(5 * cm, 27 * cm, "Torugo‚Äôs Fit - Avalia√ß√£o Corporal")

    pdf.setFont("Helvetica", 12)
    pdf.setFillColorRGB(0, 0, 0)
    pdf.drawString(2 * cm, 25 * cm, f"Sexo: {sexo}")
    pdf.drawString(2 * cm, 24.3 * cm, f"Idade: {idade} anos")
    pdf.drawString(2 * cm, 23.6 * cm, f"Peso: {peso:.1f} kg")
    pdf.drawString(2 * cm, 22.9 * cm, f"Percentual de Gordura: {percentual_gordura:.2f}%")
    pdf.drawString(2 * cm, 22.2 * cm, f"Massa Magra: {massa_magra:.2f} kg")
    pdf.drawString(2 * cm, 21.5 * cm, f"Massa Gorda: {massa_gorda:.2f} kg")
    pdf.drawString(2 * cm, 20.8 * cm, f"Classifica√ß√£o: {classificacao_final}")

    pdf.line(2 * cm, 20.6 * cm, 18 * cm, 20.6 * cm)
    pdf.setFont("Helvetica-Oblique", 10)
    pdf.drawString(2 * cm, 19.8 * cm, "M√©todo: Jackson & Pollock (7 dobras) - F√≥rmula Siri (1961)")
    pdf.drawString(2 * cm, 19.3 * cm, "Desenvolvido por Torugo‚Äôs Fit")

    pdf.showPage()
    pdf.save()

    st.download_button(
        label="üìÑ Baixar Relat√≥rio em PDF",
        data=buffer.getvalue(),
        file_name="relatorio_torugos_fit.pdf",
        mime="application/pdf",
    )